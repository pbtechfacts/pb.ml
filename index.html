<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBAI | PB Digital Solutions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700;900&family=Plus+Jakarta+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        :root { --pb-blue: #3b82f6; --pb-bg: #030712; }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--pb-bg);
            color: #f8fafc;
            background-image: radial-gradient(circle at 0% 0%, rgba(59, 130, 246, 0.1) 0, transparent 40%),
                              radial-gradient(circle at 100% 100%, rgba(59, 130, 246, 0.05) 0, transparent 40%);
        }
        .heading { font-family: 'Outfit', sans-serif; }
        .glass { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        .btn-glow { transition: all 0.3s ease; box-shadow: 0 0 0 0 rgba(59, 130, 246, 0); }
        .btn-glow:hover { box-shadow: 0 0 20px 2px rgba(59, 130, 246, 0.3); transform: translateY(-1px); }
        .loader-bar { height: 4px; width: 100%; background: #111827; border-radius: 10px; overflow: hidden; }
        .loader-fill { height: 100%; width: 40%; background: var(--pb-blue); animation: progress 2s infinite linear; }
        @keyframes progress { from { margin-left: -40%; } to { margin-left: 100%; } }
        .custom-scroll::-webkit-scrollbar { width: 5px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #1f2937; border-radius: 10px; }
        .fade-step { animation: fadeIn 0.5s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <!-- Branding Header -->
    <header class="p-6 border-b border-white/5 glass sticky top-0 z-50">
        <div class="max-w-7xl mx-auto flex justify-between items-center">
            <div class="flex items-center gap-4">
                <div class="bg-blue-600 w-10 h-10 rounded-xl flex items-center justify-center font-black italic shadow-lg text-white">PB</div>
                <div>
                    <h1 class="heading font-black text-2xl tracking-tighter">PBAI <span class="text-blue-500 underline decoration-2 underline-offset-4">INTEL</span></h1>
                    <p class="text-[10px] uppercase font-bold tracking-[0.3em] text-slate-500">PB Digital Solutions</p>
                </div>
            </div>
            <div id="status-tag" class="text-[10px] font-black uppercase tracking-widest bg-slate-900 border border-slate-800 px-4 py-1.5 rounded-full text-slate-400">
                System Ready
            </div>
        </div>
    </header>

    <main class="flex-grow max-w-5xl mx-auto w-full px-6 py-12">
        
        <!-- STEP 0: Configuration -->
        <section id="step-0" class="fade-step space-y-12">
            <div class="text-center space-y-4">
                <h2 class="heading text-5xl md:text-7xl font-black text-white leading-none">Elevate Your <br><span class="text-blue-500">Understanding.</span></h2>
                <p class="text-slate-400 text-lg">Select your parameters for a human-centric AI explanation followed by a capability audit.</p>
            </div>

            <div class="glass p-8 md:p-12 rounded-[2.5rem] shadow-2xl space-y-8">
                <div class="space-y-3">
                    <label class="text-xs font-black uppercase text-blue-400 tracking-widest">Research Topic</label>
                    <input type="text" id="input-topic" placeholder="What would you like to master today?" 
                           class="w-full bg-slate-950 border border-slate-800 p-6 rounded-2xl text-xl text-white focus:border-blue-500 outline-none transition-all shadow-inner">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-3">
                        <label class="text-xs font-black uppercase text-slate-500 tracking-widest">Language</label>
                        <select id="input-lang" class="w-full bg-slate-950 border border-slate-800 p-5 rounded-2xl text-white outline-none focus:border-blue-500 cursor-pointer">
                            <option value="English">English</option>
                            <option value="Telugu">Telugu</option>
                            <option value="Hindi">Hindi</option>
                            <option value="Spanish">Spanish</option>
                            <option value="French">French</option>
                        </select>
                    </div>
                    <div class="space-y-3">
                        <label class="text-xs font-black uppercase text-slate-500 tracking-widest">Depth Profile</label>
                        <select id="input-depth" class="w-full bg-slate-950 border border-slate-800 p-5 rounded-2xl text-white outline-none focus:border-blue-500 cursor-pointer">
                            <option value="Short">Brief Summary (1,000 Chars)</option>
                            <option value="Medium">Standard Detail (2,500 Words)</option>
                            <option value="Long">Deep Dive Research (10,000 Words)</option>
                        </select>
                    </div>
                </div>

                <button id="btn-run" class="btn-glow w-full bg-blue-600 py-6 rounded-2xl text-xl font-black text-white uppercase tracking-[0.2em]">
                    Start Intelligent Sync
                </button>
            </div>
        </section>

        <!-- STEP 1: The Explanation -->
        <section id="step-1" class="hidden fade-step space-y-8">
            <div class="flex items-center justify-between">
                <h2 id="view-topic" class="heading text-3xl font-bold text-white">Subject Transmission</h2>
                <div class="h-1 flex-grow mx-8 border-b border-dashed border-slate-800"></div>
            </div>

            <div class="glass p-8 md:p-14 rounded-[3rem]">
                <div id="text-output" class="prose prose-invert max-w-none text-slate-300 leading-relaxed text-lg custom-scroll max-h-[60vh] overflow-y-auto pr-6">
                    <!-- AI Content -->
                </div>
            </div>

            <div class="flex justify-center pt-4">
                <button id="btn-quiz" class="bg-white text-black px-12 py-5 rounded-2xl font-black text-lg hover:scale-105 transition-all shadow-xl">
                    Proceed to Quiz Audit
                </button>
            </div>
        </section>

        <!-- STEP 2: The Audit (Quiz) -->
        <section id="step-2" class="hidden fade-step space-y-8">
            <div class="flex justify-between items-center">
                <p class="text-blue-500 font-black uppercase tracking-widest text-xs">Active Audit Phase</p>
                <div id="q-progress" class="text-4xl font-black text-slate-800">01 / 20</div>
            </div>

            <div class="glass p-10 md:p-14 rounded-[3rem] space-y-12">
                <h3 id="q-label" class="text-2xl md:text-4xl font-bold text-white leading-tight"></h3>
                <div id="q-options" class="grid grid-cols-1 gap-4">
                    <!-- Interactive buttons -->
                </div>
            </div>
        </section>

        <!-- STEP 3: The Insight Report -->
        <section id="step-3" class="hidden fade-step space-y-12 pb-20">
            <div class="glass p-10 md:p-16 rounded-[4rem] border-b-8 border-blue-600">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12 items-center">
                    <div class="space-y-6 text-center md:text-left">
                        <h2 class="heading text-5xl font-black text-white leading-none italic uppercase">Audit <br><span class="text-blue-500">Results.</span></h2>
                        <div class="flex justify-center md:justify-start gap-4">
                            <div class="bg-slate-900 px-8 py-5 rounded-3xl border border-slate-800">
                                <span class="block text-[10px] font-black uppercase text-slate-500 mb-1">Score</span>
                                <span id="res-score" class="text-4xl font-black text-white">0/20</span>
                            </div>
                            <div class="bg-slate-900 px-8 py-5 rounded-3xl border border-slate-800">
                                <span class="block text-[10px] font-black uppercase text-slate-500 mb-1">Rank</span>
                                <span id="res-grade" class="text-4xl font-black text-blue-400">-</span>
                            </div>
                        </div>
                    </div>
                    <div class="flex justify-center">
                        <div class="relative w-48 h-48 flex items-center justify-center">
                            <svg class="w-full h-full -rotate-90">
                                <circle cx="96" cy="96" r="88" stroke="#0f172a" stroke-width="14" fill="none" />
                                <circle id="res-circle" cx="96" cy="96" r="88" stroke="#3b82f6" stroke-width="14" fill="none" stroke-dasharray="553" stroke-dashoffset="553" stroke-linecap="round" class="transition-all duration-1000" />
                            </svg>
                            <span id="res-percent" class="absolute text-4xl font-black text-white italic">0%</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="space-y-6">
                <h3 class="text-xl font-black text-white flex items-center gap-3">
                    <span class="w-2 h-8 bg-blue-600 rounded-full"></span>
                    Capability Breakdown & Explanations
                </h3>
                <div id="audit-review" class="grid grid-cols-1 gap-6">
                    <!-- Results with correct answers and logic -->
                </div>
            </div>

            <button onclick="location.reload()" class="w-full bg-slate-800 py-6 rounded-2xl text-xl font-bold text-white hover:bg-slate-700 transition-all uppercase tracking-widest">Restart System</button>
        </section>

        <!-- Loader -->
        <div id="master-loader" class="hidden fixed inset-0 z-[100] bg-slate-950/95 flex flex-col items-center justify-center p-8">
            <div class="w-64 space-y-6 text-center">
                <div class="loader-bar"><div class="loader-fill"></div></div>
                <h3 id="loader-txt" class="text-sm font-black text-white uppercase tracking-[0.4em]">Initializing PB Neural Sync</h3>
                <p class="text-slate-600 text-[10px] font-mono">PB DIGITAL SOLUTIONS • ENGINE V2.5</p>
            </div>
        </div>
    </main>

    <footer class="p-10 border-t border-white/5 bg-slate-950/50">
        <div class="max-w-7xl mx-auto flex flex-col md:flex-row justify-between items-center gap-8">
            <div class="flex items-center gap-4">
                <div class="bg-slate-800 p-2 rounded-lg font-black text-xs italic text-white">PB</div>
                <div class="text-[10px] font-bold text-slate-500 uppercase tracking-widest">
                    PB Digital Solutions <br> 2025 Intellectual Property
                </div>
            </div>
            <p class="text-[10px] text-slate-600 uppercase tracking-widest font-medium">© 2025 PB Digital Solutions. All Rights Reserved.</p>
        </div>
    </footer>

    <script type="module">
        // API Key configured for deployment
        const apiKey = "AIzaSyB0AfKg4I4lWNejKAnbFD4381WjwfVHZp4"; 

        const state = {
            topic: '', lang: 'English', depth: 'Medium',
            content: '', quiz: [], userAnswers: [], currentQ: 0
        };

        const toggleLoader = (show, msg) => {
            const l = document.getElementById('master-loader');
            if (msg) document.getElementById('loader-txt').innerText = msg;
            l.classList.toggle('hidden', !show);
            document.getElementById('status-tag').innerText = show ? msg : "System Ready";
        };

        const callAI = async (prompt, system) => {
            // Updated model to gemini-2.5-flash-preview-09-2025 for best performance
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }],
                systemInstruction: { parts: [{ text: system }] },
                generationConfig: { 
                    responseMimeType: "application/json",
                    temperature: 0.7
                }
            };

            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        const err = await response.text();
                        console.error("API Error details:", err);
                        throw new Error(`API Rejection: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    const rawText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!rawText) throw new Error("Empty response from AI");

                    // Sanitize JSON text
                    const cleanText = rawText.replace(/```json|```/gi, '').trim();
                    return JSON.parse(cleanText);

                } catch (e) {
                    console.warn(`Attempt ${i+1} failed:`, e);
                    if (i === 4) throw e;
                    const delay = Math.pow(2, i) * 1000;
                    await new Promise(r => setTimeout(r, delay));
                }
            }
        };

        const startSync = async () => {
            state.topic = document.getElementById('input-topic').value.trim();
            if (!state.topic) {
                alert("Please enter a research topic.");
                return;
            }
            state.lang = document.getElementById('input-lang').value;
            state.depth = document.getElementById('input-depth').value;

            toggleLoader(true, `SYNCING ${state.depth.toUpperCase()} FEED...`);

            const depthMap = {
                "Short": "A brief overview of 1,000 characters. High impact.",
                "Medium": "A standard professional explanation of about 1,000 words with sections.",
                "Long": "A deep dive research thesis of roughly 2,000 words. Be exhaustive."
            };

            const system = `PB Digital Solutions Lead AI. Topic: ${state.topic}. Language: ${state.lang}. Depth: ${state.depth}. 
            Role: Master Educator. Instructions: Provide ${depthMap[state.depth]}. 
            Style: Professional, human-friendly, clean Markdown. 
            Format: JSON only. Schema: {"explanation": "string content (markdown allowed)"}`;

            try {
                const res = await callAI(`Teach me about ${state.topic} in ${state.lang}.`, system);
                state.content = res.explanation;
                
                document.getElementById('view-topic').innerText = state.topic;
                document.getElementById('text-output').innerHTML = formatText(state.content);
                
                document.getElementById('step-0').classList.add('hidden');
                document.getElementById('step-1').classList.remove('hidden');
                window.scrollTo(0,0);
            } catch (e) { 
                console.error(e);
                alert("Critical Error: AI key failed to respond. Please check console for details."); 
            } finally { toggleLoader(false); }
        };

        const initAudit = async () => {
            toggleLoader(true, "CRAFTING 20-POINT CAPABILITY AUDIT...");
            const system = `PB Audit Officer. Task: Generate 20 high-quality MCQs for the topic ${state.topic}. 
            Assess researcher/student capabilities. Do not give answers yet. 
            Format: JSON Array of objects. Schema: [{"q": "string question", "o": ["A", "B", "C", "D"], "a": index (0-3), "e": "Human logic why this is correct"}]`;

            try {
                const res = await callAI("Generate 20 quiz questions.", system);
                if (Array.isArray(res)) {
                    state.quiz = res;
                    renderQuiz();
                    document.getElementById('step-1').classList.add('hidden');
                    document.getElementById('step-2').classList.remove('hidden');
                } else {
                    throw new Error("Invalid format received");
                }
            } catch (e) { 
                console.error(e);
                alert("Audit generation failed. Retrying...");
                // Simple retry mechanism could be added here or user clicks button again
            } finally { toggleLoader(false); }
        };

        const renderQuiz = () => {
            const current = state.quiz[state.currentQ];
            document.getElementById('q-progress').innerText = `${String(state.currentQ + 1).padStart(2, '0')} / 20`;
            document.getElementById('q-label').innerText = current.q;
            
            const grid = document.getElementById('q-options');
            grid.innerHTML = '';
            
            current.o.forEach((opt, idx) => {
                const btn = document.createElement('button');
                btn.className = "w-full text-left p-6 rounded-2xl bg-slate-900 border border-slate-800 hover:border-blue-500 hover:bg-blue-500/5 transition-all text-lg font-medium text-slate-300 flex items-center gap-4";
                btn.innerHTML = `<span class="w-10 h-10 rounded-xl bg-slate-800 flex items-center justify-center text-xs font-black text-blue-500">${String.fromCharCode(65+idx)}</span> <span>${opt}</span>`;
                btn.onclick = () => {
                    state.userAnswers.push(idx);
                    state.currentQ++;
                    if (state.currentQ < 20) renderQuiz(); else showResults();
                };
                grid.appendChild(btn);
            });
            window.scrollTo(0,0);
        };

        const showResults = async () => {
            toggleLoader(true, "CALCULATING AUDIT SCORE...");
            const score = state.userAnswers.reduce((acc, v, i) => acc + (v === state.quiz[i].a ? 1 : 0), 0);
            const pct = Math.round((score / 20) * 100);

            const resSys = `PB Analyst. Topic: ${state.topic}. Score: ${score}/20. 
            Grade the student. Output JSON: {"grade": "string (e.g. S-Tier, A, B, C, F)"}`;
            
            try {
                const gradeData = await callAI("Grade results.", resSys);
                document.getElementById('res-score').innerText = `${score}/20`;
                document.getElementById('res-grade').innerText = gradeData.grade;
                document.getElementById('res-percent').innerText = `${pct}%`;
                
                const circle = document.getElementById('res-circle');
                // 553 is the circumference for radius 88
                circle.style.strokeDashoffset = 553 - (553 * (pct / 100));

                const review = document.getElementById('audit-review');
                review.innerHTML = '';
                
                state.quiz.forEach((q, i) => {
                    const isOk = state.userAnswers[i] === q.a;
                    const card = document.createElement('div');
                    card.className = `glass p-8 rounded-3xl border-l-4 ${isOk ? 'border-green-500' : 'border-red-500'} space-y-4`;
                    card.innerHTML = `
                        <div class="flex justify-between items-start">
                            <span class="text-[10px] font-black uppercase tracking-widest ${isOk ? 'text-green-500' : 'text-red-500'}">${isOk ? 'Mastered' : 'Knowledge Gap'} • Q${i+1}</span>
                        </div>
                        <p class="text-xl font-bold text-white">${q.q}</p>
                        <div class="p-5 bg-blue-500/5 rounded-2xl border border-blue-500/10">
                            <p class="text-[10px] font-black text-blue-400 uppercase mb-2">PBAI Correct Logic:</p>
                            <p class="text-sm text-slate-300 leading-relaxed">${q.e}</p>
                        </div>
                    `;
                    review.appendChild(card);
                });

                document.getElementById('step-2').classList.add('hidden');
                document.getElementById('step-3').classList.remove('hidden');
                window.scrollTo(0,0);
            } catch (e) { 
                console.error(e);
                alert("Grading failed."); 
            }
            finally { toggleLoader(false); }
        };

        const formatText = (t) => {
            if (!t) return "";
            return t.replace(/^## (.*$)/gim, '<h2 class="text-2xl font-black text-white mt-10 mb-4 border-b border-white/5 pb-2">$1</h2>')
                    .replace(/^### (.*$)/gim, '<h3 class="text-xl font-bold text-white mt-6 mb-2">$1</h3>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong class="text-blue-400 font-bold">$1</strong>')
                    .replace(/^\* (.*$)/gim, '<li class="ml-4 mb-3 list-none flex gap-3"><span class="text-blue-500">◆</span> <span>$1</span></li>')
                    .replace(/\n\n/g, '<div class="h-6"></div>');
        };

        document.getElementById('btn-run').onclick = startSync;
        document.getElementById('btn-quiz').onclick = initAudit;
    </script>
</body>
</html>


